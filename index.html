<!DOCTYPE html><html lang="en"><head>

  <title>FX_HASH_p5</title>


<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
      <script src="jquery.min.js" defer></script>
    <script src="bignumber.min.js" defer></script>
    <script src="netpbm-parser.js" defer></script>
      <script src="numtowords.js" defer></script>
    <script src="index.js" defer></script> 
  <div id="p5"><script src="sketch.js"></script></div>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8">

  
  
  
  
  
  
  
  
  
  
  
  
  
    <script id="fxhash-snippet">
      let alphabet = "123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"
      var fxhash = 'oo1pKoCCJVDKxYcp2Zipfb4hfHN9Ry1Q2xYAQPhyiv4vCnQwP2d'
      let b58dec = (str) => str.split('').reduce((p,c,i) => p + alphabet.indexOf(c) * (Math.pow(alphabet.length, str.length-i-1)), 0)
      let fxhashTrunc = fxhash.slice(2)
      let regex = new RegExp(".{" + ((fxhash.length/4)|0) + "}", 'g')
      let hashes = fxhashTrunc.match(regex).map(h => b58dec(h))
      let sfc32 = (a, b, c, d) => {
        return () => {
          a |= 0; b |= 0; c |= 0; d |= 0
          var t = (a + b | 0) + d | 0
          d = d + 1 | 0
          a = b ^ b >>> 9
          b = c + (c << 3) | 0
          c = c << 21 | c >>> 11
          c = c + t | 0
          return (t >>> 0) / 4294967296
        }
      }
      var fxrand = sfc32(...hashes)

  function compress() {
 var imgCur = document.getElementById('inp').value;
 var jimmy = [];
let compressedImg = imgCur.split('').reduce((o, c, d) => {
  if (o[o.length - 2] === c && o[o.length - 1] < 35) o[o.length - 1]++;
  else 
   o.push(c, '');
 if (o[o.length - 3] % d) jimmy.push(d);
    else jimmy.push(o[o.length - 3]);
  return o;
},[]).map(_ => typeof _ === 'number' ? _.toString(36) : _).join('');
 

  var imgCur2 = document.getElementById('inp').value;
 var jim = [];
let compressedImg2 = imgCur2.split('').reduce((p, e, t) => {
  if (p[p.length - 2] === e && p[p.length - 1] < 35) p[p.length - 1]++;
  else 
   p.push(e, 0);
 if (p[p.length - 3] % t) jim.push(t);
    else jim.push(p[p.length - 3]);
  return p;
},[]).map(__ => typeof __ === 'number' ? __.toString(36) : __).join('');
 
 
 var str = compressedImg; 
 function findRepeat(str) {
  const arr = str.split('');
  const hash = new Map();
  const result = [];
  for (let i = 0; i < arr.length; i++) {
    if (hash.get(arr[i]) === undefined) {
      hash.set(arr[i], true);
    } else {
      const value = hash.get(arr[i]);
      if (value) {
        hash.set(arr[i], !value);
      }
    }
  }
  hash.forEach((v, k, g) => {
    if (!v || g)
      result.push(k);
  });
  return result;
}
 
 document.getElementById('out').value = 'Public Key: 3v' + findRepeat(str).join('') + '\n\nView Key: 6v' + compressedImg +  '\n\nPriv Key: #' + btoa(jimmy.join('')) + '\n\nMaster Key: Mv#' + btoa(compressedImg2) + '\n\n';
 
 document.getElementById('inp').value = '';
}


function restore(){
 var compressedImgCur1 = document.getElementById('out').value.replace('Mv#', '');
 var compressedImgCur = atob(compressedImgCur1);
let decompressedImgCur = compressedImgCur
  .split('').map((c,i,a)=>i%2?undefined:new Array(2+parseInt(a[i+1],36)).join(c)).join('');
 document.getElementById('inp').value = decompressedImgCur;
}
  
  </script>



       
        
    </center>
        
   
   
</p> 
    

    <center><div id="grid"></div></center>
<meta charset="UTF-8" />
<title>Wzór Tuppera - Narzędzia</title>
<link rel="shortcut icon" href="//tuppers-formula.ovh/favicon.ico" type="image/icon">
<link rel="icon" href="//tuppers-formula.ovh/favicon.ico" type="image/icon"> 
<style>
body {
 margin: 20px;
 background-color: #FAFAFA;
}

h2 {
	text-align: center;
}
table{
	border:1px solid #000000;
}
td {
	width: 12px;
	height: 12px;
	font-size: 1px;
//	border:1px solid #000000;
}
tr:last-child td {
	border-width:0px 1px 0px 0px;
}
tr td:last-child {
	border-width:0px 0px 1px 0px;
}
tr:last-child td:last-child {
	border-width:0px 0px 0px 0px;
}

.black {
	background-color: #000;
	padding: 0px;
	margin: 0px;
}

.white {
	background-color: #fff;
	padding: 0px;
	margin: 0px;
}
#wiki, #graphOptionsDiv, #numberOptionsDiv {
	border-style: dashed;
	border-width: 2px;
	border-color: #00F;
}
#no_stepsDiv {
	border-style: dashed;
	border-width: 2px;
	border-color: #0F0;
	padding: 5px;
}
#wikiMore, #graphOptions, #numberOptions {
	margin: 20px;
//	display: none;
}
#wikiLogo {
	float: left;
	padding: 0px 20px 0px 0px;
}
#wikiText {
	float: left;
}

canvas {
    background-color: #FFF;
}


textarea {
    width: 950px;
	height: 120px;
}

.toggleButton {
	cursor: pointer;
}

#buttonsDiv {
	margin: 20px 0px;
	width: 950px;
    text-align: center;
}


</style>

<script language="javascript">

  ///////////////////////////////////////////////////////////////
 //   Show/hide div                                           //
///////////////////////////////////////////////////////////////
	function toggleDiv(id)
	{
		var div = document.getElementById(id);
		if(div.style.display == 'none')
		{
			div.style.display = 'block';
			div.parentNode.getElementsByClassName('toggleButton')[0].innerHTML = div.parentNode.getElementsByClassName('toggleButton')[0].innerHTML.replace(/\[\+\]/, '[-]');
		}
		else
		{
			div.style.display = 'none';
			div.parentNode.getElementsByClassName('toggleButton')[0].innerHTML = div.parentNode.getElementsByClassName('toggleButton')[0].innerHTML.replace(/\[-\]/, '[+]');
		}
		
	}
	
		 /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	   /////////////                                    CANVAS STUFF                                          //////////////
	  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	var canvas, canvas2, ctx;
	var resizeCanvas2=false;
	
	var invertedAxes = false;
	
	var pixelsPerUnit = 8;
	
	if(pixelsPerUnit<3)
	{
		resizeCanvas2 = true;
		alert('1 unit should be at least 3 pixels wide (2 pixels used for grid).\Increasing value to 3 pixels.');
	}
	else if(pixelsPerUnit>8)
	{
		resizeCanvas2 = true;
		alert('Resizing canvas (originally designed for 8 pixel per unit)');	
	}
	var xa = 8*pixelsPerUnit;
	var ya = 11*pixelsPerUnit;
	var xb = xa + pixelsPerUnit*106;
	var yb = ya + 17*pixelsPerUnit;
	var axl = 6*pixelsPerUnit;
	var penDown = false;
	var evCntr = 0;
	var color1 = 'green';
	var color2 = 'white';

	var i, j;
	var pixArr = new Array(17);
	for (i=0; i<17; ++i)
	{
		pixArr[i] = new Array(106);
		for(j=0; j<106; ++j)
			pixArr[i][j] = 0;
	}
	
	var isPixArrUpToDate = true;
	
	window.addEventListener('load', canvasApp, false);	

  ///////////////////////////////////////////////////////////////
 //   Init canvas                                             //
///////////////////////////////////////////////////////////////	
	function canvasApp()
	{
		canvas=document.getElementById("canvas");
		if(resizeCanvas2)
		{
			if(pixelsPerUnit<3)
				pixelsPerUnit = 3;
			else
			{
				canvas.width = Math.ceil(canvas.width*pixelsPerUnit/8);
				canvas.height = Math.ceil(canvas.height*pixelsPerUnit/8);
			}
		}
		canvas2 = document.getElementById("canvas2");
		ctx=canvas.getContext("2d");
		
		canvas.addEventListener('keydown',  function (e) {keyboardHndlr(e);}, true);

		
		canvas.addEventListener("mousemove", function (e) {
			mouseHndlr('move', e)
		}, false);
		canvas.addEventListener("mousedown", function (e) {
			mouseHndlr('down', e)
		}, false);
		canvas.addEventListener("mouseup", function (e) {
			mouseHndlr('up', e)
		}, false);
		canvas.addEventListener("mouseout", function (e) {
			mouseHndlr('out', e)
		}, false);
		
		canvas.oncontextmenu = function (e) {
			e.preventDefault();
		};
		
		var goIA = document.getElementById('go_invertAxes');
		if(goIA && goIA.checked==true)
			goIA.checked = false;
		drawAxes(invertedAxes);
		drawGrid();
		clearGrid();
		
		var urlNum;
		var hash = window.location.hash;
		if(hash.length>1)
		{
			urlNum = hash.replace(/[^0-9]/g, '');
			document.getElementById('numTA').value = urlNum;
			num2Graph(urlNum);
		}
	
	}
	
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Select brush color for first mouse button (other buttons use second color)  //
	///////////////////////////////////////////////////////////////////////////////////
	function chooseColor(c)
	{
		if(c==0)
		{
			color1 = 'white';
			color2 = 'black';
			document.getElementById('go_black').style.borderColor = '#00F';
			document.getElementById('go_white').style.borderColor = '#F00';
		}
		else
		{
			color1 = 'black';
			color2 = 'white';	
			document.getElementById('go_black').style.borderColor = '#F00';
			document.getElementById('go_white').style.borderColor = '#00F';
		}
	}
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Handler for keyboard events                                                 //
	///////////////////////////////////////////////////////////////////////////////////
	function keyboardHndlr(e)
	{
		if(e.keyCode==38)
		{
			moveUp();
			if(evCntr<2)
				++evCntr;
			else if(evCntr==2)
				;
			else
				evCntr = 0;
			e.preventDefault();
		}
		else if(e.keyCode==40)
		{
			moveDown();
			if(evCntr>=2 && evCntr<4)
				++evCntr;
			else
				evCntr = 0;
			e.preventDefault();
		}
		else if(e.keyCode==37)
		{
			moveLeft();
			if(evCntr==4 || evCntr==6)
				++evCntr;
			else
				evCntr = 0;
			e.preventDefault();
		}
		else if(e.keyCode==39)
		{
			moveRight();
			if(evCntr==5 || evCntr==7)
				++evCntr;
			else
				evCntr = 0;
			e.preventDefault();
		}
		else if(e.keyCode==66 && evCntr==8)
			++evCntr;
		else if(e.keyCode==65 && evCntr==9)
			++evCntr;
		else
			evCntr = 0;
	
		if(e.keyCode==82)
		{
			resetGraph();
		}
		if(evCntr==10)
		{

//alert(':-)');
			runTests();
			evCntr = 0;
		}
		
//		e.preventDefault();
	}

	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Handler for mouse events                                                    //
	///////////////////////////////////////////////////////////////////////////////////	
	function mouseHndlr(res, e)
	{
		var currX = e.pageX - canvas.offsetLeft;
		var currY = e.pageY - canvas.offsetTop;
		
		if(currX >= xa && currX < xb && currY >= ya && currY < yb)
		{
			isPixArrUpToDate = false;
			
			if (res == 'down')
			{
				penDown = true;
				// draw 1 pixel
				if(e.which == 1)
				{
					ctx.fillStyle = color1;
				}
				
/////////////////////
/* // middle mouse button - pixel info
				else if(e.which == 2)
				{
					var imgData = ctx.getImageData(currX, currY, 1, 1);
					alert('x='+currX+' y='+currY+'\nR:'+imgData.data[0] + ' G:'+imgData.data[1] + ' B:'+imgData.data[2] + ' A:'+imgData.data[3]);
					e.preventDefault();			
				}
*/
/////////////////////
				
				else
				{
					ctx.fillStyle = color2;
				}
				ctx.fillRect(Math.floor(currX/pixelsPerUnit)*pixelsPerUnit+1, Math.floor(currY/pixelsPerUnit)*pixelsPerUnit+1, pixelsPerUnit-2, pixelsPerUnit-2);
				
			}
			if (res == 'up' || res == "out") 
			{
				penDown = false;
			}
			if (res == 'move') 
			{
				if (penDown)
				{
					// draw under mouse
					ctx.fillRect(Math.floor(currX/pixelsPerUnit)*pixelsPerUnit+1, Math.floor(currY/pixelsPerUnit)*pixelsPerUnit+1, pixelsPerUnit-2, pixelsPerUnit-2);
				}
			}
		}
		else
		{
			penDown = false;
		}
	}
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Store canvas in array pixArr[]                                              //
	///////////////////////////////////////////////////////////////////////////////////
	function canvas2arr()
	{
		var binStr = '';
//		var str = '';
		var imgData = ctx.getImageData(xa, ya, xb-xa, yb-ya);
		var i, j; 
		
		for (i=0; i<17; ++i)
		{
			for(j=0; j<106; ++j)
			{
				if(imgData.data[((i*pixelsPerUnit+pixelsPerUnit/2)*106*pixelsPerUnit+j*pixelsPerUnit+pixelsPerUnit/2)*4] == 255)
				{
					pixArr[i][j] = 0; // probably white pixel in center of "big" pixel; [R,G,B,A]==[255,?,?,?]
					binStr += '0';
				}
				else
				{
					pixArr[i][j] = 1; // otherwise should be black...
					binStr += '1';
				}
//				str += imgData.data[((i*pixelsPerUnit+pixelsPerUnit/2)*106*pixelsPerUnit+j*pixelsPerUnit+pixelsPerUnit/2)*4] +',';
			}
//			str += '\n';
			binStr += '\n';
		}
		isPixArrUpToDate = true;
		return binStr;
	}
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Draw on canvas using values from pixArr[]                                 //
	///////////////////////////////////////////////////////////////////////////////////
	function arr2canvas()
	{
		var i, j; 
		
		for (j=0; j<17; ++j)
		{
			for(i=0; i<106; ++i)
			{
				if(pixArr[j][i] == 0)
				{
					ctx.fillStyle = 'white';
					ctx.fillRect(xa+i*pixelsPerUnit+1, ya+j*pixelsPerUnit+1, pixelsPerUnit-2, pixelsPerUnit-2);
				}
				else
				{
					ctx.fillStyle = 'black';
					ctx.fillRect(xa+i*pixelsPerUnit+1, ya+j*pixelsPerUnit+1, pixelsPerUnit-2, pixelsPerUnit-2);
				}
			}
		}	
	}
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   DEBUG: Dump pixArr[]                                                       //
	///////////////////////////////////////////////////////////////////////////////////
	function printArr()
	{
		var i, j, str = '';
		for (i=0; i<17; ++i)
		{
			for(j=0; j<106; ++j)
			{
				str += pixArr[i][j] + ',';
			}
			str += '\n';
		}
		console.log(str);
		return(str);
	}
	
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   (re)draw 106 x 17 grid                                                      //
	///////////////////////////////////////////////////////////////////////////////////
	function drawGrid()
	{
		var i;
		ctx.lineWidth = 1;
		ctx.strokeStyle = 'gray';
		ctx.beginPath();
		for(i=xa; i<xb; i+=pixelsPerUnit)
		{
			ctx.moveTo(i, ya);
			ctx.lineTo(i, yb);
		}
		for(i=ya; i<yb; i+=pixelsPerUnit)
		{
			ctx.moveTo(xa, i);
			ctx.lineTo(xb, i);
		}
		ctx.stroke();

	}
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   draw XY axes on canvas                                                      //
	///////////////////////////////////////////////////////////////////////////////////	
	function drawAxes(inverted)
	{		

		var i, j;
		
		ctx.clearRect(0, 0, canvas.width, ya);
		ctx.clearRect(0, yb, canvas.width, canvas.height-yb);
		ctx.clearRect(0, 0, xa, canvas.height);
		ctx.clearRect(xb, 0, canvas.width-xb, canvas.height);
		
		ctx.lineWidth = 1;
		ctx.strokeStyle = 'white';
		ctx.strokeRect(xa, ya, 106*pixelsPerUnit, 17*pixelsPerUnit);
		ctx.strokeStyle = 'gray';
		ctx.strokeRect(xa, ya, 106*pixelsPerUnit, 17*pixelsPerUnit);
		
		ctx.strokeStyle = 'black';
		ctx.fillStyle = 'black';

		ctx.beginPath();
		for(i=xa; i<xb; i+=16)
		{
			ctx.moveTo(i, ya);
			ctx.lineTo(i+16, ya-axl);
			ctx.moveTo(i, yb+axl);
			ctx.lineTo(i+16, yb);
		}


		if(inverted)
		{
			ctx.lineWidth = 2;

			ctx.moveTo(xb, yb+axl);
			ctx.lineTo(xb, ya-axl);
			ctx.lineTo(xa-axl, ya-axl);
			
			// arrows
			ctx.moveTo(xa-axl+5, ya-axl+5);
			ctx.lineTo(xa-axl, ya-axl);
			ctx.lineTo(xa-axl+5, ya-axl-5);
			ctx.moveTo(xb-5, yb+axl-5);
			ctx.lineTo(xb, yb+axl);
			ctx.lineTo(xb+5, yb+axl-5);
			
			// graduation?
			ctx.moveTo(xb, ya-axl-pixelsPerUnit);
			ctx.lineTo(xb, ya-axl);
			ctx.moveTo(xa, ya-axl);
			ctx.lineTo(xa, ya-axl-pixelsPerUnit);
			
			ctx.moveTo(xb, ya);
			ctx.lineTo(xb+pixelsPerUnit, ya);
			ctx.moveTo(xb, yb);
			ctx.lineTo(xb+pixelsPerUnit, yb);
			
			ctx.stroke();
			
			// txt
			ctx.font = "bold 18px sans-serif";
			ctx.fillText("x", xa-axl-pixelsPerUnit, ya-axl-pixelsPerUnit);
			ctx.fillText("y", xb+pixelsPerUnit, yb+axl+pixelsPerUnit);
			ctx.fillText("k+17", xb+2*pixelsPerUnit, yb+pixelsPerUnit/2);
			ctx.fillText("k", xb+2*pixelsPerUnit, ya+pixelsPerUnit/2);
			ctx.fillText("0", xb, ya-axl-2*pixelsPerUnit);
			ctx.fillText("106", xa-2*pixelsPerUnit, ya-axl-2*pixelsPerUnit);
	
		}
		else
		{
		
			ctx.lineWidth = 2;
			//ctx.beginPath();
			ctx.moveTo(xa, ya-axl);
			ctx.lineTo(xa, yb+axl);
			ctx.lineTo(xb+axl, yb+axl);
			
			// arrows
			ctx.moveTo(xa-5, ya-axl+5);
			ctx.lineTo(xa, ya-axl);
			ctx.lineTo(xa+5, ya-axl+5);
			ctx.moveTo(xb+axl-5, yb+axl-5);
			ctx.lineTo(xb+axl, yb+axl);
			ctx.lineTo(xb+axl-5, yb+axl+5);	
			
			// graduation?
			ctx.moveTo(xa, yb+axl+pixelsPerUnit);
			ctx.lineTo(xa, yb+axl);
			ctx.moveTo(xb, yb+axl);
			ctx.lineTo(xb, yb+axl+pixelsPerUnit);
			
			ctx.moveTo(xa, ya);
			ctx.lineTo(xa-pixelsPerUnit, ya);
			ctx.moveTo(xa, yb);
			ctx.lineTo(xa-pixelsPerUnit, yb);
			
			ctx.stroke();
			
			// txt
			ctx.font = "bold 18px sans-serif";
			ctx.fillText("x", xb+axl+pixelsPerUnit/2, yb+axl-2*pixelsPerUnit);
			ctx.fillText("y", xa-2*pixelsPerUnit, ya-axl-pixelsPerUnit);
			ctx.fillText("k+17", xa-7*pixelsPerUnit, ya+pixelsPerUnit/2);
			ctx.fillText("k", xa-3*pixelsPerUnit, yb+pixelsPerUnit/2);
			ctx.fillText("0", xa-pixelsPerUnit, yb+axl+4*pixelsPerUnit);
			ctx.fillText("106", xb-2*pixelsPerUnit, yb+axl+4*pixelsPerUnit);
				
		}
		
		// white zig-zag
		ctx.lineWidth = 10;
		ctx.strokeStyle = 'white';
		ctx.beginPath();
		
		ctx.moveTo(xa+2, ya-10);
		ctx.lineTo((xa+xb)/2+50, ya-axl+10);
		ctx.lineTo((xa+xb)/2-50, ya-10);
		ctx.lineTo(xb-2, ya-axl+10);
		
		ctx.moveTo(xa+2, yb+axl-10);
		ctx.lineTo((xa+xb)/2+50, yb+10);
		ctx.lineTo((xa+xb)/2-50, yb+axl-10);
		ctx.lineTo(xb-2, yb+10);
		
		ctx.stroke();
		
		// to lazy to clear rect border over axes
		ctx.lineWidth = 1;
		ctx.strokeStyle = 'white';
		ctx.strokeRect(xa, ya, 106*pixelsPerUnit, 17*pixelsPerUnit);
		ctx.strokeRect(xa, ya, 106*pixelsPerUnit, 17*pixelsPerUnit);
		ctx.strokeRect(xa, ya, 106*pixelsPerUnit, 17*pixelsPerUnit);
		ctx.strokeRect(xa, ya, 106*pixelsPerUnit, 17*pixelsPerUnit);
		ctx.strokeRect(xa, ya, 106*pixelsPerUnit, 17*pixelsPerUnit);
		
		ctx.strokeStyle = 'gray';
		ctx.strokeRect(xa, ya, 106*pixelsPerUnit, 17*pixelsPerUnit);
	}
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Clear 106 x 17 grid content                                                 //
	///////////////////////////////////////////////////////////////////////////////////
	function clearGrid()
	{
		var i,j;
	
		ctx.fillStyle = 'white';
		for(j=0; j<17; ++j)
			for(i=0; i<106; ++i)
			{
				ctx.fillRect(xa+i*pixelsPerUnit+1, ya+j*pixelsPerUnit+1, pixelsPerUnit-2, pixelsPerUnit-2);
				pixArr[j][i] = '0';
			}
		isPixArrUpToDate = true;

	}
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Reset whole canvas content                                                  //
	///////////////////////////////////////////////////////////////////////////////////
	function resetGraph()
	{
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		drawAxes(invertedAxes);
		drawGrid();
		clearGrid();
	}
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Invert X & Y axes                                                           //
	///////////////////////////////////////////////////////////////////////////////////
	function invertAxes()
	{
		var goIA = document.getElementById('go_invertAxes');
		if(goIA && goIA.checked==true)
		{
			invertedAxes = true;
		}
		else
		{
			invertedAxes = false;
		}
		
		drawAxes(invertedAxes);

	}
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Move graph one unit left                                                    //
	///////////////////////////////////////////////////////////////////////////////////	
	function moveLeft()
	{
		var imgData=ctx.getImageData(xa+pixelsPerUnit,ya,105*pixelsPerUnit,17*pixelsPerUnit);
		ctx.putImageData(imgData,xa,ya);
		ctx.fillStyle = 'white';
		for(var j=0; j<17; ++j)
			ctx.fillRect(xa+105*pixelsPerUnit+1, ya+j*pixelsPerUnit+1, pixelsPerUnit-2, pixelsPerUnit-2);
		isPixArrUpToDate = false;
		
	}
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Move graph one unit right                                                   //
	///////////////////////////////////////////////////////////////////////////////////	
	function moveRight()
	{
		var imgData=ctx.getImageData(xa,ya,105*pixelsPerUnit,17*pixelsPerUnit);
		ctx.putImageData(imgData,xa+pixelsPerUnit,ya);
		ctx.fillStyle = 'white';
		for(var j=0; j<17; ++j)
			ctx.fillRect(xa+1, ya+j*pixelsPerUnit+1, pixelsPerUnit-2, pixelsPerUnit-2);		
		isPixArrUpToDate = false;
	}

	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Move graph one unit up                                                      //
	///////////////////////////////////////////////////////////////////////////////////		
	function moveUp()
	{
		var imgData=ctx.getImageData(xa,ya+pixelsPerUnit,106*pixelsPerUnit,16*pixelsPerUnit);
		ctx.putImageData(imgData,xa,ya);
		ctx.fillStyle = 'white';
		for(var j=0; j<106; ++j)
			ctx.fillRect(xa+j*pixelsPerUnit+1, ya+16*pixelsPerUnit+1, pixelsPerUnit-2, pixelsPerUnit-2);
		isPixArrUpToDate = false;
	}

	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Move graph one unit down                                                    //
	///////////////////////////////////////////////////////////////////////////////////	
	function moveDown()
	{
		var imgData=ctx.getImageData(xa,ya,106*pixelsPerUnit,16*pixelsPerUnit);
		ctx.putImageData(imgData,xa,ya+pixelsPerUnit);
		ctx.fillStyle = 'white';
		for(var j=0; j<106; ++j)
			ctx.fillRect(xa+j*pixelsPerUnit+1, ya+1, pixelsPerUnit-2, pixelsPerUnit-2);
		isPixArrUpToDate = false;
	}
	

	   /////////////////////////////////////////////////////////////////////////////////////////////////////////////
	  //   If possible, move graph maximally to left without loosing any black pixels                            //
	 //   Produces smaller Tupper's number, when axes are set as in Cartesian coordinate system - NOT inverted  //
	/////////////////////////////////////////////////////////////////////////////////////////////////////////////
	function moveMaxLeft()
	{
		var i,j, foundSth = false;
		
		canvas2arr();
		
		for(j=0; j<106; ++j)
		{
			for(i=0; i<17; ++i)
			{
				if(pixArr[i][j]==1)
				{
					foundSth = true;
					break;
				}
				
			}
			if(foundSth)
				break;
		}
		if(foundSth)
		{
			for(i=j; i>0; --i)
				moveLeft();
		}	
	}
	
	   /////////////////////////////////////////////////////////////////////////////////////
	  //   If possible, move graph maximally to right without loosing any black pixels   //
	 //   Produces smaller Tupper's number, when axes are inverted                      //
	/////////////////////////////////////////////////////////////////////////////////////
	function moveMaxRight()
	{
		var i,j, foundSth = false;
		
		canvas2arr();
		
		for(j=105; j>=0; --j)
		{
			for(i=0; i<17; ++i)
			{
				if(pixArr[i][j]==1)
				{
					foundSth = true;
					break;
				}
				
			}
			if(foundSth)
				break;
		}
		if(foundSth)
		{
			for(i=j; i<105; ++i)
				moveRight();
		}
	}
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Flip graph around (local) Y axis (reflect horizontally)                     //
	///////////////////////////////////////////////////////////////////////////////////
	function flipImageY()
	{
		var str = canvas2arr();

		var i, j, k;
		
		for(i=0,j=105,k=0; k<str.length && i<17; ++k)
		{
			if(str.charAt(k) == '0')
			{
				pixArr[i][j] = 0;
			}
			else if(str.charAt(k) == '1')
			{
				pixArr[i][j] = 1;
			}
			else
				continue;
				
			--j;
			if(j<0)
			{
				j = 105;
				++i;
			}
		}
		arr2canvas();
		isPixArrUpToDate = true;

	}
	
	  ///////////////////////////////////////////////////////////////////////////////////
	 //   Flip graph around (local) X axis (reflect vertically)                       //
	///////////////////////////////////////////////////////////////////////////////////	
	function flipImageX()
	{
		var str = canvas2arr();

		var i, j, k;
		
		for(i=16,j=0,k=0; k<str.length && i>=0; ++k)
		{
			if(str.charAt(k) == '0')
			{
				pixArr[i][j] = 0;
			}
			else if(str.charAt(k) == '1')
			{
				pixArr[i][j] = 1;
			}
			else
				continue;
				
			++j;
			if(j>105)
			{
				j = 0;
				--i;
			}
		}
		arr2canvas();
		isPixArrUpToDate = true;
	}
	
	  ////////////////////////////////////////////////////////////////////////////////////
	 //   Invert colors of graph (black/white -> white/black)                          //
	////////////////////////////////////////////////////////////////////////////////////	
	function negative()
	{
		var str = canvas2arr();

		var i, j, k;
		
		for(i=0,j=0,k=0; k<str.length && i<17; ++k)
		{
			if(str.charAt(k) == '0')
			{
				pixArr[i][j] = 1;
			}
			else if(str.charAt(k) == '1')
			{
				pixArr[i][j] = 0;
			}
			else
				continue;
				
			++j;
			if(j>105)
			{
				j = 0;
				++i;
			}
		}
		arr2canvas();
		isPixArrUpToDate = true;
	}
	
	  ///////////////////////////////////////////////////////////////
	 //   Invert graph                                            //
	///////////////////////////////////////////////////////////////		
	function invertGraph()
	{
		flipImageX();
		flipImageY();
	}
	
	function runTests()
	{
		var assertVal1 = '35118444841267448013404150941800145728048599656l629146324687335986901379736401217S15281055462558552887192ll0082640641937'
					   + '666275171405531633925231708061577861898153631213760S7546l025926490075228967388020531261756457025676745373714088346879474'
					   + '04257165656075478779404916361425754630174709045643390135091223022770088185286183772054369904494S847l75371355113714S28354'
					   + '764293812670633359819683164579828025466805293703544125647114660864S9482134S393661222874325138515541436374l45430179273572'
					   + '82449632238144532921813602283194458348773893648913616S7068835604480';
		if(document.getElementById('numTA'))
			document.getElementById('numTA').value = ('30lO'+assertVal1).replace(/s/gi, 4+1).replace(/[^0-9]/g, '');
		else
		{
			alert("Missing textarea with id 'numTA'");
			return -1;
		}
		if(invertedAxes)
		{
			document.getElementById('go_invertAxes').checked = false;
			invertAxes();
		}
		num2Graph(('30lO'+assertVal1).replace(/s/gi, 4+1).replace(/[^0-9]/g, ''));
//		if(pixArr[0][0] != '0')
//			alert('Wrong pixel color');
		var cnt = 6;
		var iv = setInterval(function(){if(cnt-- > 0) negative(); else clearInterval(iv);}, 800);	
//		if(pixArr[0][0] != '0')
//			alert('Wrong pixel color');
		
	}
	  ///////////////////////////////////////////////////////////////
	 //   Graph to binary number                                  //
	///////////////////////////////////////////////////////////////		
	function graph2Bin()
	{
		var i,j, out='';
		
		if(!isPixArrUpToDate)
			canvas2arr();
		if(invertedAxes)
		{
			for(j=0; j<106; ++j)
			{
				for(i=16; i>=0; --i)
				{
					out += pixArr[i][j];					
				}
			}
			
		}
		else
		{
			for(j=105; j>=0; --j)
			{
				for(i=0; i<17; ++i)
				{
					out += pixArr[i][j];					
				}
			}
		}
		return out;
	}
	
	  ///////////////////////////////////////////////////////////////
	 //   Binary number to graph                                  //
	///////////////////////////////////////////////////////////////		
	function bin2Graph(bin)
	{
		var i,j, out='';
		bl = bin.length;
		if(bl<1802)
			bin = pad1802(bin);

		if(invertedAxes)
		{
			for(j=0; j<106; ++j)
			{
				for(i=16; i>=0; --i)
				{
					pixArr[i][j] = bin[j*17+16-i];					
				}
			}
			
		}
		else
		{
			for(j=105; j>=0; --j)
			{
				for(i=0; i<17; ++i)
				{
					pixArr[i][j] = bin[(105-j)*17+i];					
				}
			}
		}
		arr2canvas();
		isPixArrUpToDate = true;
	}
		
	  ///////////////////////////////////////////////////////////////
	 //   Tupper's number ('k' offset) to graph                   //
	///////////////////////////////////////////////////////////////		
	function num2Graph(num)
	{
		
		if(num.length < 1)
		{
			alert('No number to convert');
			return -1;
		}
		
		var num2 = divideBy17BN(num);
///////////////////////////////////////////////////////!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
		var num2r = num2.substring(num2.indexOf('|')+1);
		if(num2r != '0')
		{			
			alert('Liczba nie jest podzielna przez 17 (reszta = ' + (num2r) + ').\nZmień liczbę lub metodę rysowania.');
			return -1;
		}
		else
			num2 = num2.replace(/\|0$/, '');
		bin2Graph(pad1802(dec2binBN(num2)));
		return 0;
	}
		
	  ///////////////////////////////////////////////////////////////
	 //   Tuppers number ('k' offset) for graph                   //
	///////////////////////////////////////////////////////////////		
	function graph2Num()
	{
		return bin2decBN(multBin17(graph2Bin()))
	}
	
	  ///////////////////////////////////////////////////////////////
	 //   Draw Tuppers self-referential formula                   //
	///////////////////////////////////////////////////////////////	
	function drawTSRF(rev)
	{
		var numTSRF;
		var goIA = document.getElementById('go_invertAxes');

		if(rev)
		{
			numTSRF = '96093937991895888497167296212785275471500433966012930665150551927170280239526642468' +
			 '96428421743507181212671537827706233559932372808741443078913259639413377234878577357498239266' +
			 '29715517173716995165232890538221612403238855866184013235585136048828693337902491454229288667' +
			 '08109618449609170518345406782773155170540538162738096760256562501698148208341878316384911559' +
			 '02256100036523513703438744618483787372381982248498634650331594100549747005931383392264972494' +
			 '61751545728366702369745461014655997933798537483143786841806593422227898388722980000748404719';
			goIA.checked = true;
			invertedAxes = true;
			drawAxes(invertedAxes);
		}
		else
		{
			numTSRF = '48584506361897134235820959624942020445814005879832445494830930850619347047088099284' +
			 '50644769865524364849997247024915119110411605739177407856919754326571855442057210445735883681' +
			 '82982375413963433822519945219165128434833290513119319995350241375876523926487461339490687013' +
			 '05622958132194811136853395355652908500238750928568926945559742815463865107300491067230589335' +
			 '86052544096664351265349363643957125565695936815184334857605266940161251266951421550539554519' +
			 '153785457525756590740540157929001765967965480064427829131488548259914721248506352686630476300';
			goIA.checked = false;
			invertedAxes = false;
			drawAxes(invertedAxes);
		}
		document.getElementById('numTA').value = numTSRF;
		num2Graph(numTSRF);
	}
		
	  //////////////////////////////////////////////////////////////////////////////////////////
	 //   Place binary number (read from left-to-right, top-to-bottom) in pixel array        //
	 //   and draw it. Useful to import binary "image" from Excel, Calc, *.txt file, etc.   //
	/////////////////////////////////////////////////////////////////////////////////////////
	function bin2arr()
	{
		var bs = document.getElementById('numTA').value;
		
		if(bs.match(/[2-9a-zA-Z]/))
		{
			alert('Error: Non-binary digits in number field.');
			return;
		}
		bs = bs.replace(/[^01]/g, '');

		if(bs.length != 1802)
		{
			alert('Warning: There should be exactly 1802 binary digits (instead of '+bs.length+'). Padding with zeros, but it might damage image.');
			bs = pad1802(bs);
		}
		
		var i, j; 
		
		for (i=0; i<17; ++i)
		{
			for(j=0; j<106; ++j)
			{
				if(bs[i*106+j] == 0)
				{
					pixArr[i][j] = 0; // white pixel
				}
				else
				{
					pixArr[i][j] = 1; // black
				}

			}
		}
		arr2canvas();
	}
	
	  /////////////////////////////////////////////////////////////////////////////////
	 //   Plot graph calculating values of Tupper's formula for each square unit    //
	/////////////////////////////////////////////////////////////////////////////////
	function calcGraph_Unit(num)
	{	
		var x,y, yy, t1, t1r, t2, t3, t4, b1, b2;
		
		for(y=0; y<17; ++y)
		{
			for(x=0; x<106; ++x)
			{
				yy = addBN(num, y.toString());
				t1 = divideBy17BN(yy).toString();

				t1r = parseInt(t1.substring(t1.indexOf('|')+1));
				t1 = t1.substring(0, t1.indexOf('|'));
				
				t3 = 17 * x + t1r;
				b1 = dec2binBN(t1).toString();
			
				if(t3 >= b1.length)
					b2 = '0';
				else
					b2 = b1.slice(0, b1.length-t3)
				t4 = bin2decBN(b2);
				if('02468'.indexOf(t4.slice(-1)) >= 0) // ..... % 2 == 0
					pixArr[16-y][x] = 0;
				else
					pixArr[16-y][x] = 1;
			}
		}
		arr2canvas();
		
		if(invertedAxes)
			invertGraph();
	}
	
	  /////////////////////////////////////////////////////////////////////////////////
	 //   Plot graph using selected method    									    //
	/////////////////////////////////////////////////////////////////////////////////
	function plotGraph()
	{	
		document.getElementById('numTA').value = document.getElementById('numTA').value.replace(/[-.,]/g, '');
		if(document.getElementById('go_smartPlot').checked)
			num2Graph(document.getElementById('numTA').value.replace(/[^0-9]/g, ''));
		else
			calcGraph_Unit(document.getElementById('numTA').value.replace(/[^0-9]/g, ''));
	}
	
	  ///////////////////////////////////////////////////////////////
	 //   Generate PNG image with a graph and number              //
	///////////////////////////////////////////////////////////////
	function generatePNG()
	{
		var i, offset;
		var incForm = document.getElementById('includeFormula').checked;
//		var canvas2 = document.getElementById("canvas2");
		var tupFormImg = document.getElementById("tuppersFormula");
		canvas2.width = 233;
		if(incForm)
		{
			canvas2.height = 680;
			offset = 0;
		}
		else
		{
			canvas2.height = 289;
			offset = 0;
		}
		
		var ctx2=canvas2.getContext("2d");
		ctx2.fillStyle = 'white';
		ctx2.clearRect(0, 0, canvas2.width, canvas2.height);
		ctx2.fillRect(0, 0, canvas2.width, canvas2.height);
		
		if(incForm)
		{
			ctx2.drawImage(tupFormImg, 360, 32);
			ctx2.fillRect(350+tupFormImg.width, 32, 10, 32);
		}
		
		ctx2.drawImage(canvas, 0, offset);
		
		var num = document.getElementById('numTA').value.trim();
		var numO = '';
		
		for(i=0; i<num.length; ++i)
		{
			if(i%76==0 && i>0)
			{
				numO += '\n';
			}
			numO += num.charAt(i);
		}
		ctx2.fillStyle = 'black';
		ctx2.font = "bold 20px sans-serif";
		var y = 360+offset;
		ctx2.fillText("k = ", 50, y);
	    var lineHeight = ctx2.measureText("M").width * 1.2;
		var lines = numO.split("\n");
		for(i=0; i<lines.length; ++i)
		{
			ctx2.fillText(lines[i].trim(), 90, y);
			y += lineHeight;
		
		}
		
		document.getElementById('link2img').href = canvas2.toDataURL();
		document.getElementById('link2img').style.display = 'block';
		document.getElementById('link2img2').style.display = 'block';
		document.getElementById('linkWithNum').style.display = 'block';
		document.getElementById('linkWithNum').href = '#' + document.getElementById('numTA').value.replace(/[^0-9]/g, '');

	}
	
	
	  ///////////////////////////////////////////////////////////////
	 //   Workaround for IE's restrictions for data URI           //
	///////////////////////////////////////////////////////////////
	function openImgInNewWin()
	{
			var docString = '<html><body><img src="'+canvas2.toDataURL("image/png")+'"/></body></html>';
			var win = window.open();
			win.document.write(docString);
			win.document.close();
	}
	
	
		 /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	   /////////////                               BIG NUMBERS STUFF                                          //////////////
	  /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	 /////////////              !!!!   does not work with negative numbers !!!!                             //////////////
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 
		
	  ///////////////////////////////////////////////////////////////
	 //   Multiply big (decimal) number stored as string by 2     //
	///////////////////////////////////////////////////////////////
	function mult2BN(fact)
	{
	  var out = '';
	  var bp, cr = 0;
	  for(var i=fact.length-1; i>=0; --i)
	  {
		bp = (fact[i] * 2 + cr);
		cr = parseInt(bp/10); // substring?
		out = bp%10 + '' + out;
	  }
	  out = (cr>0?cr:'') + '' + out;
	  return out;
	}


	  ///////////////////////////////////////////////////////////////
	 //   Add two big (decimal) numbers stored as strings         //
	///////////////////////////////////////////////////////////////
	function addBN(op1, op2)
	{
	  var out = '';
	  var i, j, st, cr = 0;
	  var op1l=op1.length;
	  var op2l=op2.length;
	/*  
	  for(i=op1l-1,j=op2l-1; i>=0 || j>=0; --i, --j)
	  {
		st = (i>=0 ? op1[i] : 0) + (j>=0 ? op2[j] : 0);
		cr = parseInt(st/10); // substring?
		out = st%10 + '' + out;
	  }
	*/
	  if(op1l>op2l)
	  {
		for(i=op1l-1,j=op2l-1; j>=0; --i,--j)
		{
		  st = parseInt(op1[i]) + parseInt(op2[j]) + cr;
		  cr = parseInt(st/10); // substring?
		  out = st%10 + '' + out;
		}
		for(; i>=0; --i)
		{
		  st = parseInt(op1[i]) + cr;
		  cr = parseInt(st/10); // substring?
		  out = st%10 + '' + out;     
		}
		out = (cr>0?cr:'') + '' + out;
	  }
	  else
	  {
		for(i=op1l-1,j=op2l-1; i>=0; --i,--j)
		{
		  st = parseInt(op1[i]) + parseInt(op2[j]) + cr;
		  cr = parseInt(st/10); // substring?
		  out = st%10 + '' + out;
	 //     alert('['+i+','+j+ '] st='+st+', cr='+cr+', out='+out);
		}
		for(; j>=0; --j)
		{
		  st = parseInt(op2[j]) + cr;
		  cr = parseInt(st/10); // substring?
		  out = st%10 + '' + out;     
		}
		out = (cr>0?cr:'') + '' + out;
	  }
	  
	  return out;
	  
	}

	   ///////////////////////////////////////////////////////////////
	  //   Compare two big (decimal) numbers stored as strings     //
	 //        op1>op2 -> 1, op1==op2 -> 0, op1<op2 -> -1         //
	///////////////////////////////////////////////////////////////
	function compareBN(op1, op2)
	{
	  var op1l=op1.length;
	  var op2l=op2.length;
	  if(op1l>op2l)
		return 1;
	  else if(op1l<op2l)
		return -1;
	  // same length:
	  for(var i=0; i<op1l; ++i)
	  {
		if(op1[i] > op2[i])
		  return 1;
		else if(op1[i] < op2[i])
		  return -1;
	  }
	  return 0;
	}

	  ///////////////////////////////////////////////////////////////
	 //   Substract two big (decimal) numbers stored as strings   //
	///////////////////////////////////////////////////////////////
	function subtractBN(op1, op2) // op1 must be >= op2 !!!!!!!!!
	{
	  var out = '';
	  var i, j, cr=0, tmp;
	  var op1l=op1.length;
	  var op2l=op2.length;
	  
	  
	  for(i=op1l-1,j=op2l-1; j>=0; --i,--j)
	  {
		tmp = parseInt(op1[i]) - parseInt(op2[j]) - cr;
		if(tmp<0)
		{
		   cr = 1;
		   tmp += 10; 
		}
		else
		  cr = 0;
		out = tmp + '' + out;
	  }
	  for(; i>=0; --i)
	  {
		tmp = parseInt(op1[i]) - cr;
		if(tmp<0)
		{
		   cr = 1;
		   tmp += 10; 
		}
		else
		  cr = 0;
		out = tmp + '' + out;   
	  }
	  // cr should be 0 (if only op1 was >= op2)
	  // trim leading zeroes
	  out = out.replace(/^0+/, '');
	  if(out.length == 0)
		out = '0';
	  return out;  
	}

	  ///////////////////////////////////////////////////////////////
	 //   Divide big (decimal) number stored as strings by 17     //
	///////////////////////////////////////////////////////////////  
	function divideBy17BN(n) // return format: quotient|remainder (for example: 123456787654|16)
	{
	 var tmp, nl = (''+n).length;
	 var out = '';
	  
	 if(nl<11)
	 {
		var ni= parseInt(n);
//		if(ni%17 != 0)
//			return -1 * (ni%17);
	   return parseInt(ni/17) + '|' + (ni%17);  
	 }
	   
	 
	 tmp = n[0];
	 for(i=1; i<nl; ++i)
	 {
	   tmp += '' + n[i];
	   tmp2 = parseInt(tmp);
	   tmp3 = parseInt(tmp2/17);
	   
	   if(tmp3 < 1)
	   {
		 out += '0';
		 continue;
	   }
	   out +=  '' + tmp3;
	   tmp = tmp2 - 17*tmp3; 
	  }

	  out = out.replace(/^0+/, '');
	  if(out.length == 0)
		out = '0';

	  out +=  '|' + parseInt(tmp);	// appending remainder
//	  if(tmp != 0 && returnReminder)
//		return -1 * tmp;
	  return out;  
	  
	}

	  //////////////////////////////////////////////////////////////////////////////////////////
	 //   Convert big binary number (passed as string) to decimal (also stored as string)    //
	//////////////////////////////////////////////////////////////////////////////////////////
	function bin2decBN(b)
	{
	  var bl = b.length;
	  var i, k;
	  if(bl<33)
	  {
		return '' + parseInt(b,2);
	  }
	  var out = 0;
	  
	  for(i=bl-1, k=0; i>=0&&k<32; --i, k++)
	  {
		if(b[i]=='1')
		{
		  out += Math.pow(2,k);
		}
	  }
	  var curPowOf2 = Math.pow(2,k-1);
	//  alert(i+','+k+')) '+ curPowOf2+'\n'+out);
	  for(; i>=0; --i, k++)
	  {
		curPowOf2 = mult2BN(''+curPowOf2);
		if(b[i]=='1')
		{
		  out = addBN(''+out, ''+curPowOf2);
		}
	//    alert(i+','+k+') '+ curPowOf2+'\n'+out);
	  }
	  return out;
	  
	}

	  //////////////////////////////////////////////////////////////////////////////////////
	 //   Convert big (decimal) number (passed as string) to binary (string, too)        //
	//////////////////////////////////////////////////////////////////////////////////////
	function dec2binBN(d)
	{
	  var dl = d.length;
	  var i, diff, out='';
	  
	  if(dl<33)
	  {
		return parseInt(d,10).toString(2);
	  }
	  var pows = [];
	  for(i=0; i<32; ++i)
	  {
		tmp = Math.pow(2, i);
		pows[i] = '' + tmp;
	  }
	  tmp +='';
	  for(; dl>tmp.length; ++i)
	  {
		tmp = mult2BN(tmp);
		pows[i] = tmp;
	  }
	  for(; compareBN(''+d, tmp)>=0; ++i)
	  {
		tmp = mult2BN(tmp);
		pows[i] = tmp;
	  }
	  --i;
	  diff = ''+d;
	//  alert(diff);
	  for(;i>=0;--i)
	  {
		if(compareBN(diff, pows[i])>=0)
		{
		  out += '1';
		  diff = subtractBN(diff, pows[i]);
	//      alert(i+') pows[i]='+pows[i]+'\ndiff='+diff+'\nout='+out);
		}
		else
		  out += '0';
	  }
	  out = out.replace(/^0+/, '');
	  if(out.length == 0)
		out = '0'; 
	  
	  return out;  
	}

	  ///////////////////////////////////////////////////////////////////////////////////////
	 //   Pad binary number (passed as string) with leading zeros (to 1802 digits)        //
	///////////////////////////////////////////////////////////////////////////////////////
	function pad1802(num)
	{
	  var s = num+"";
	  while (s.length < 1802)
		s = "0" + s;
	  return s;
	  
	}

	  ///////////////////////////////////////////////////////////////
	 //   Simple binary string formatter (Tuppers Formula)        //
	///////////////////////////////////////////////////////////////
	function quickFormat(str)
	{
	  var out = '';
	  for(i=0; i<str.length; ++i)
	  {
		if(i%17==0)
		  out += '\n' + str[i];
		else
		  out += '\t' + str[i];
	  }
	  return out;
	}

	  ///////////////////////////////////////////////////////////////
	 //   Add two big (binary) numbers stored as strings          //
	///////////////////////////////////////////////////////////////
	function addBin(op1, op2)
	{
	  var out = '';
	  var i, j, st, cr = 0;
	  var op1l=op1.length;
	  var op2l=op2.length;

	  if(op1l>op2l)
	  {
		for(i=op1l-1,j=op2l-1; j>=0; --i,--j)
		{
		  st = parseInt(op1[i]) + parseInt(op2[j]) + cr;
		  cr = parseInt(st/2); // use substring instead?
		  out = st%2 + '' + out;
		}
		for(; i>=0; --i)
		{
		  st = parseInt(op1[i]) + cr;
		  cr = parseInt(st/2); // substring?
		  out = st%2 + '' + out;     
		}
		out = (cr>0?cr:'') + '' + out;
	  }
	  else
	  {
		for(i=op1l-1,j=op2l-1; i>=0; --i,--j)
		{
		  st = parseInt(op1[i]) + parseInt(op2[j]) + cr;
		  cr = parseInt(st/2); // substring?
		  out = st%2 + '' + out;
	 //     alert('['+i+','+j+ '] st='+st+', cr='+cr+', out='+out);
		}
		for(; j>=0; --j)
		{
		  st = parseInt(op2[j]) + cr;
		  cr = parseInt(st/2); // substring?
		  out = st%2 + '' + out;     
		}
		out = (cr>0?cr:'') + '' + out;
	  }
	  
	  return out;
	}

	  ///////////////////////////////////////////////////////////////
	 //   Multiply big (binary) number stored as strings by 17    //
	///////////////////////////////////////////////////////////////
	function multBin17(bin)
	{
		var out;
		
		out = bin + '0000';
		out = addBin(out, bin);
		return out;
	}

	  ///////////////////////////////////////////////////////////////
	 //   Generate random "Big Number" divisible by 17            //
	///////////////////////////////////////////////////////////////
	function randomBN17(allBits)
	{
		var i, j=1802, b='0';
		if(!allBits)
			j = Math.round(Math.random()*1802);
		for(i=0; i<j; ++i)
			b += new String((Math.round(Math.random() * 1234567)+ new Date().getTime()*1357)%2);
		b17 = multBin17(b);
		return(bin2decBN(b17));
	}
	
	
	    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	   /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	  /////////////                               NUMBER FIELD STUFF                                         //////////////
	 /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 
		
	  ///////////////////////////////////////////////////////////////
	 //   Separate thousands (using white space character)        //
	///////////////////////////////////////////////////////////////
	function separateThousands()
	{
		var out = '';
		var num = document.getElementById('numTA').value.replace(/[^0-9]/g, '');
		if(num.length>3)
		{
			for(var i=num.length-1,j=0; i>=0; --i,++j)
			{
				if(j%3==0 && j>0)
				{
					out = ' ' + out;
				}
				out = num.charAt(i) + out;
			}
			document.getElementById('numTA').value = out;
		}
		else
		{
			document.getElementById('numTA').value = num;
		}
		
	}

	  ///////////////////////////////////////////////////////////////
	 //   Remove all non numeric characters                       //
	///////////////////////////////////////////////////////////////
	function removeNonNumeric()
	{
		document.getElementById('numTA').value = document.getElementById('numTA').value.replace(/[^0-9]/g, '');
	}
	
	  ///////////////////////////////////////////////////////////////
	 //   Clear number field                                      //
	///////////////////////////////////////////////////////////////
	function clearNum()
	{
		document.getElementById('numTA').value = '';
	}
	
	  ///////////////////////////////////////////////////////////////
	 //   Show intermediate values                                //
	///////////////////////////////////////////////////////////////
	function showSteps()
	{
		var num1 = document.getElementById('numTA').value.replace(/[^0-9]/g, '');
		var num2 = divideBy17BN(num1);
		num2 = num2.substring(0, num2.indexOf('|'));
		var num2o = '';
		var binO = '';
		var bin2o = '';		
		var bin3a, bin3o;
		
		var i, j, k;
		
		for(i=0; i<num2.length; ++i)
		{
			if(i%106==0 && i>0)
			{
				num2o += '\n';
			}
			num2o += num2.charAt(i);
		}
		var bin = pad1802(dec2binBN(num2));

		
		for(i=0; i<bin.length; ++i)
		{
			if(i%106==0 && i>0)
			{
				binO += '\n';
			}
			binO += bin.charAt(i);
		}
		
		for(j=0; j<17; ++j)
		{
			for(i=105; i>=0; --i)
				bin2o += bin.charAt(i*17+j);
			bin2o += '\n';
		}
		
		bin3a = bin2o.split('\n');
		bin3a = bin3a.reverse();
		for(k=0;k<bin3a.length; ++k)
			bin3a[k] =  bin3a[k].split('').reverse().join('');
		bin3o = bin3a.join('\n');
		
		var stepsHTML = '\n<br />\n<strong>Podzielona przez 17:</strong><br />\n<pre>\n' + num2o + '\n</pre><br /><br />\n<strong>Dwójkowo:</strong><br />\n<pre>\n' + binO 
					+ '\n</pre>\n<br /><br />\n<strong>Dwójkowo (z podziałem na 106 kolumn z 17-bitowymi liczbami):</strong><br />\n<pre>\n' + bin2o + '\n</pre>\n\n<br /><br />\n<strong>Dwójkowo (z podziałem na 106 kolumn z 17-bitowymi liczbami - odwrócone):</strong><br />\n<pre>\n' + bin3o + '\n</pre>\n';
		document.getElementById('no_steps').innerHTML = stepsHTML;
		if(document.getElementById('no_steps').style.display == 'none')
			toggleDiv('no_steps');
	}
	
	
</script>



</head>
<center>
<body>
  
  <center><br>
    	  <div id="datamoth">
            P1<br>
            106 17<br>         
            1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111<br>
            1111111111111111111111111111111111111111111100011111111111000111111111111111111111111111111111111111111111<br>
            1100000011111111111111101111111111111111111110001111111110000111111111111111111111111111111111111111111111<br>
            1101111000001111111111101111111111111111111110000111111110000111111111111011111111111111111111111111111111<br>
            1101111111101111111111100111111111111111111110000111111100001111111111111011111111111111101111110111111111<br>
            1101111111101111111110110111111111111111111111000011111000001111111111111001111111111111101111110111111111<br>
            1101111111101111111110000111111111111111111111000001111000001111111011110001111111101111101110110111111111<br>
            1101111111101111111111100000001111111111111111000000010000001111111001110100111111000111100000110111111111<br>
            1101111111101110000011110111111111111111111111000000000000001111111001110110111111010011000111110000111111<br>
            1101111111101111111001110111111111111111111111000000000000001111110010110110011110011011101111110010111111<br>
            1101111111001100000001110111100011111111111111100000000000011111110111010111011110111011101111110111011111<br>
            1101111111011101111001110111001101111111111111000000000000011111110111100111001110111011101111110111011111<br>
            1101111111011101111001110100011101111111111111000000000000011111100111100111101110111011101111110111011111<br>
            1100000000111101111001110101111000111111111111000000010000011111101111110111101110111011100111110111011111<br>
            1111111111111101111001110100001010011001111111100000010000011111101111111111111110000111110111111111111111<br>
            1111111111111100000000110111100011000011111111100001111000111111111111111111111111001111111111111111111111<br>
            1111111111111111111100111111111111111111111111110001111001111111111111111111111111111111111111111111111111<br></div></center>

 
    <center> 
    <a href="#4858487703182312513400597878822819808988695486580197277684452096504734505393166426886283222873126606689179192908166794948550050772187190459205301115928926884342947673144041133111365027316053950834135904477672386461321586003959375057995612308880437437463598486619301291088146430571259882538007541827584985027786047090428419066794136269255023707135350492002326646115371089126706426075172249806712588928979889314717354183628312868819106593130490187550238035193781913352215473354690203619320613954646528752371024628332102672756201204196068542119919" onclick="myFunction()" class="currentpage">#datamoth</a>


    
    <div id="presets">
        <button p=0 dec="0">
        Clear</button>
        <button p=2 dec="960939379918958884971672962127852754715004339660129306651505519271702802395266424689642842174350718121267153782770623355993237280874144307891325963941337723487857735749823926629715517173716995165232890538221612403238855866184013235585136048828693337902491454229288667081096184496091705183454067827731551705405381627380967602565625016981482083418783163849115590225610003652351370343874461848378737238198224849863465033159410054974700593138339226497249461751545728366702369745461014655997933798537483143786841806593422227898388722980000748404719">
        Self-referencing</button>

        <button p=2 dec="960939379918958884971672962127852754715004339660129306651505519271702802395266424689642842174350718121267153782770623355993237280874144307891325963941337723487857735749823926629715517173716995165232890538221612403238855866184013260522753122461549418660848184788512583419422760972591200813120977848037656423089104040982064477496888800557578380632137393189901536685420214238570784204054100880556256139816373230468970660533160429753220133608095153403766635687948739730842418327362281018940453558210790069088474973124708711014221138053801848209391">
        Keely</button>

         <button p=27 dec="21531275725487">
        Miusoph <3</button>   
                                          
        <input type="file" id="netpbm" name="file" />
             
      
             

             </div></center>
    <br>
<center>
    Bits <span id="bitError" class="error"></span><br>
    <textarea id="bitArea" style="width:42%; placeholder="The Binary String"></textarea><br>
<input type="hidden" name="showCommas" value="0" />
    Decimal(<i>k</i>) <small><input type="checkbox" checked id="showCommas" value="0" />Show Commas</small>
    <span id="decError" class="error"></span><br>
    <textarea id="decArea" style="width:42%; placeholder="The k Decimal"></textarea><br>

    Words <small></small><br>
    <textarea id="wordsArea" style="width:42%; placeholder="Number as words" readonly></textarea>
    
    
	<br />
	<input type="button" id="no_showSteps" onclick="generatePNG()" value="Utwórz obrazek z powyższym wykresem i liczbą"/> (najpierw upewnij się, że wykres i liczba są spójne)
	<input type="checkbox" id="includeFormula"/> <label for="includeFormula">Dołączyć wzór Tuppera?</label><br />
	Uwzględnia odwrócenie osi i rozdzielenie tysięcy.
	<br />
	<div id="graphDiv">
		<canvas id="canvas" width="528" height="320" tabindex="0">
			Twoja przeglądarka nie obsługuje HTML 5 Canvas. 
		</canvas>
	<canvas id="canvas2" width="0" height="0" style="/*display:none*/">
		Twoja przeglądarka nie obsługuje HTML 5 Canvas. 
	</canvas>
	<a id="link2img" target="_blank" style="display:none">Link do obrazka (otwiera się w nowym oknie, nie działa w IE)</a>
	<a id="link2img2" href="javascript:void()" onclick="openImgInNewWin()" style="display:none">Otwórz obrazek w nowym oknie (dla IE)</a>
	<a id="linkWithNum" target="_blank" href="" style="display:none">Link do tej strony wraz z liczbą</a>

	
	</div>
  <body><center>    <center><textarea id="stringArea" style="width:42%;height:17%;text-align:center;" placeholder="String" readonly></textarea></center>
    <p align="center"><table align="center"><tr align="center"></tr><td><tr>
    <center><textarea id="inp" style="width:42%;text-align:center;" rows="10" placeholder="String Goes Here" align="center"></textarea></tr></center>
    <tr><td><center><input type="button" value="Cut Keys" onClick="compress();" /></center></td></tr></td><td><tr><br>
    <center><textarea id="out" style="width:42%;text-align:center;" align="center" placeholder="Keys Go Here" rows="10"></textarea></tr></td></center><br>
  <tr><td><center><input type="button" value="Restore Master" onClick="restore();" /></center></td>&nbsp;</tr>&nbsp;&nbsp;</table></p>
  <hr>
 <div align="center">
  <h3 align="center">
    <script src="hash.js"></script>


</h3></body></html>
